export BABEL_CACHE_PATH=$HOME/Developer/.babel-cache.json
export YARN_CACHE_FOLDER=$HOME/Developer/.yarn-cache

export PATH=$PATH:$HOME/.yarn/bin
export PATH=$PATH:$HOME/bin
export PATH=$PATH:$HOME/opt/bin
export PATH=$PATH:/Applications/Genymotion.app/Contents/MacOS/tools

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

function cdEnhanced() {
    cd $1
    doNvm
}

function doNvm() {
    if [ -f .nvmrc ]; then
        nvm use;
    fi
}

function gitEnhanced() {
    if [[ $@ == "remote" ]]; then
        command git remote -v
    else
        command git "$@"
    fi
}

function gitUpstream() {
    CURRENT_BRANCH="$(git rev-parse --abbrev-ref HEAD)"
    git checkout master
    git fetch upstream
    git rebase upstream/master
    git push origin master
    git checkout "${CURRENT_BRANCH}"
}

function gitPullRequest() {
    local remote=${2:-origin}
    git fetch ${remote} +refs/pull/$1/head:refs/remotes/${remote}/pr/$1
    git pull --no-rebase --squash ${remote} pull/$1/head
}

function gitPullRequestUpstream() {
    git reset --hard
    gitUpstream
    local remote=${2:-upstream}
    git fetch ${remote} +refs/pull/$1/head:refs/remotes/${remote}/pr/$1
    git pull --no-rebase --squash ${remote} pull/$1/head
}

function showall() {
    defaults write com.apple.finder AppleShowAllFiles $1
    killall Finder
}

function whiteboard() {
    # https://gist.github.com/lelandbatey/8677901
    # brew install imagemagick
    command convert "$1" -morphology Convolve DoG:15,100,0 -negate -normalize -blur 0x1 -channel RBG -level 60%,91%,0.1 "$2"
}

function yarnInstall() {
    echo "Uninstalling yarn..."
    rm -f /usr/local/bin/yarnpkg
    rm -f /usr/local/bin/yarn

    echo "Removing yarn cache..."
    if [ -z ${YARN_CACHE_FOLDER+x} ]; then
        rm -rf ${YARN_CACHE_FOLDER}
    else
        rm -rf ${HOME}/.yarn
    fi

    echo "Installing yarn..."
    curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version $1
}

doNvm

alias cd=cdEnhanced
alias flush="sudo dscacheutil -flushcache;sudo killall -HUP mDNSResponder;"
alias github-labels="labels -c $HOME/Developer/github-labels.json -f $1 -t $GITHUB_LABELS_TOKEN"
alias git=gitEnhanced
alias gitp="git push origin head"
alias gitpr=gitPullRequest
alias gitpru=gitPullRequestUpstream
alias gitr="git reset --hard HEAD && git clean -xfd"
alias gitrb="git branch | grep -ve \"master\" | xargs git branch -D"
alias gitu=gitUpstream
alias j="jekyll serve --watch"
alias ls="ls -la"
alias mkdir="mkdir -p"
alias server="python -m SimpleHTTPServer 8000"
alias showall=showall
alias sourcerc="source ~/.bash_profile && source ~/.zshrc"
alias usebash="chsh -s /bin/bash"
alias usezsh="chsh -s /bin/zsh"
alias whiteboard=whiteboard
alias yarni=yarnInstall
alias yarnr="rm -rf node_modules && yarn"
alias yarnu="yarn upgrade-interactive --latest"
